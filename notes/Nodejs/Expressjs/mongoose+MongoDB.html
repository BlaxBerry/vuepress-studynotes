<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>mongoose模块 | BlaxBerry</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Chen's Program Study Note">
    
    <link rel="preload" href="/vuepress-studynotes/assets/css/0.styles.176c083a.css" as="style"><link rel="preload" href="/vuepress-studynotes/assets/js/app.c0f0cecf.js" as="script"><link rel="preload" href="/vuepress-studynotes/assets/js/2.4e3782e5.js" as="script"><link rel="preload" href="/vuepress-studynotes/assets/js/36.6d59d549.js" as="script"><link rel="prefetch" href="/vuepress-studynotes/assets/js/10.30ab456b.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/11.ed9af68f.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/12.00ef22a5.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/13.3628705c.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/14.5a177f19.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/15.c79e5b43.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/16.fb723d3e.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/17.f8d8d6aa.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/18.a67f24e9.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/19.30f32bd0.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/20.c41d3929.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/21.00146b1a.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/22.eb577a06.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/23.d1d8fdd8.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/24.a18dcd5e.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/25.7689d549.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/26.13d948e9.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/27.45107160.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/28.a2b259da.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/29.3d156e4f.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/3.e89fcfeb.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/30.49ef3902.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/31.531916fb.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/32.f85b65cc.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/33.52c8dba4.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/34.719bbd19.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/35.f0bc75a1.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/37.917e8cf6.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/38.d692b05a.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/39.80ab50da.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/4.8ad4b204.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/40.1465f016.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/41.074701a2.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/42.abffd3a3.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/43.16b9a35f.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/44.40562c18.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/45.faf7b2a1.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/46.6da7955b.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/47.815df48a.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/48.b9a3b386.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/49.6eb59e0d.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/5.b826813d.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/50.74646484.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/51.9926e43e.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/52.6ed98b9d.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/53.4cfd6999.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/54.38961476.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/55.54ced284.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/56.1200e8b6.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/57.ce0067a0.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/58.14742721.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/59.ee7ebbb2.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/6.8bf2eab4.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/60.dd08078a.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/61.7d2a9558.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/62.227e0aeb.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/63.ccb4fca3.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/64.df2edacf.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/65.2e802b03.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/66.d6d9feeb.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/67.0de42ecd.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/7.1c9e1e68.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/8.56093963.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/9.7ca49f60.js">
    <link rel="stylesheet" href="/vuepress-studynotes/assets/css/0.styles.176c083a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepress-studynotes/" class="home-link router-link-active"><img src="/vuepress-studynotes/logo.jpg" alt="BlaxBerry" class="logo"> <span class="site-name can-hide">BlaxBerry</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vuepress-studynotes/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/vuepress-studynotes/guide/" class="nav-link">
  Catalog
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Hot" class="dropdown-title"><span class="title">Hot</span> <span class="arrow down"></span></button> <button type="button" aria-label="Hot" class="mobile-dropdown-title"><span class="title">Hot</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Front-End
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepress-studynotes/notes/Javascript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-subitem"><a href="/vuepress-studynotes/notes/Vue/" class="nav-link">
  Vue.js
</a></li><li class="dropdown-subitem"><a href="/vuepress-studynotes/notes/React/" class="nav-link">
  React
</a></li></ul></li><li class="dropdown-item"><h4>
          Server-Side
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepress-studynotes/notes/Nodejs/" class="nav-link router-link-active">
  Node.js
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://blaxberry.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Portfolio
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/BlaxBerry/vuepress-studynotes" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vuepress-studynotes/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/vuepress-studynotes/guide/" class="nav-link">
  Catalog
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Hot" class="dropdown-title"><span class="title">Hot</span> <span class="arrow down"></span></button> <button type="button" aria-label="Hot" class="mobile-dropdown-title"><span class="title">Hot</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Front-End
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepress-studynotes/notes/Javascript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-subitem"><a href="/vuepress-studynotes/notes/Vue/" class="nav-link">
  Vue.js
</a></li><li class="dropdown-subitem"><a href="/vuepress-studynotes/notes/React/" class="nav-link">
  React
</a></li></ul></li><li class="dropdown-item"><h4>
          Server-Side
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/vuepress-studynotes/notes/Nodejs/" class="nav-link router-link-active">
  Node.js
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://blaxberry.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Portfolio
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/BlaxBerry/vuepress-studynotes" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>mongoose模块</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vuepress-studynotes/notes/Nodejs/Expressjs/mongoose+MongoDB.html#安装" class="sidebar-link">安装</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-studynotes/notes/Nodejs/Expressjs/mongoose+MongoDB.html#数据库连接" class="sidebar-link">数据库连接</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-studynotes/notes/Nodejs/Expressjs/mongoose+MongoDB.html#创建集合" class="sidebar-link">创建集合</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-studynotes/notes/Nodejs/Expressjs/mongoose+MongoDB.html#创建并插入文档" class="sidebar-link">创建并插入文档</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress-studynotes/notes/Nodejs/Expressjs/mongoose+MongoDB.html#方法1-创建文档实例" class="sidebar-link">方法1  创建文档实例</a></li><li class="sidebar-sub-header"><a href="/vuepress-studynotes/notes/Nodejs/Expressjs/mongoose+MongoDB.html#方法2-集合的create" class="sidebar-link">方法2  集合的create()</a></li><li class="sidebar-sub-header"><a href="/vuepress-studynotes/notes/Nodejs/Expressjs/mongoose+MongoDB.html#create-的promise形式" class="sidebar-link">create() 的Promise形式</a></li></ul></li><li><a href="/vuepress-studynotes/notes/Nodejs/Expressjs/mongoose+MongoDB.html#查询文档" class="sidebar-link">查询文档</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress-studynotes/notes/Nodejs/Expressjs/mongoose+MongoDB.html#find-查询文档" class="sidebar-link">find() 查询文档</a></li><li class="sidebar-sub-header"><a href="/vuepress-studynotes/notes/Nodejs/Expressjs/mongoose+MongoDB.html#findone-查询文档" class="sidebar-link">findOne() 查询文档</a></li><li class="sidebar-sub-header"><a href="/vuepress-studynotes/notes/Nodejs/Expressjs/mongoose+MongoDB.html#查询条件" class="sidebar-link">查询条件</a></li><li class="sidebar-sub-header"><a href="/vuepress-studynotes/notes/Nodejs/Expressjs/mongoose+MongoDB.html#链式编程多个筛选条件" class="sidebar-link">链式编程多个筛选条件</a></li></ul></li><li><a href="/vuepress-studynotes/notes/Nodejs/Expressjs/mongoose+MongoDB.html#删除文档" class="sidebar-link">删除文档</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress-studynotes/notes/Nodejs/Expressjs/mongoose+MongoDB.html#删除单个" class="sidebar-link">删除单个</a></li><li class="sidebar-sub-header"><a href="/vuepress-studynotes/notes/Nodejs/Expressjs/mongoose+MongoDB.html#删除多个" class="sidebar-link">删除多个</a></li></ul></li><li><a href="/vuepress-studynotes/notes/Nodejs/Expressjs/mongoose+MongoDB.html#更新文档" class="sidebar-link">更新文档</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress-studynotes/notes/Nodejs/Expressjs/mongoose+MongoDB.html#更新一个" class="sidebar-link">更新一个</a></li><li class="sidebar-sub-header"><a href="/vuepress-studynotes/notes/Nodejs/Expressjs/mongoose+MongoDB.html#更新多个" class="sidebar-link">更新多个</a></li></ul></li><li><a href="/vuepress-studynotes/notes/Nodejs/Expressjs/mongoose+MongoDB.html#mongoose验证规则" class="sidebar-link">mongoose验证规则</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress-studynotes/notes/Nodejs/Expressjs/mongoose+MongoDB.html#required" class="sidebar-link">required</a></li><li class="sidebar-sub-header"><a href="/vuepress-studynotes/notes/Nodejs/Expressjs/mongoose+MongoDB.html#minlength-maxlength" class="sidebar-link">minlength maxlength</a></li><li class="sidebar-sub-header"><a href="/vuepress-studynotes/notes/Nodejs/Expressjs/mongoose+MongoDB.html#trim" class="sidebar-link">trim</a></li><li class="sidebar-sub-header"><a href="/vuepress-studynotes/notes/Nodejs/Expressjs/mongoose+MongoDB.html#min-max" class="sidebar-link">min max</a></li><li class="sidebar-sub-header"><a href="/vuepress-studynotes/notes/Nodejs/Expressjs/mongoose+MongoDB.html#default" class="sidebar-link">default</a></li><li class="sidebar-sub-header"><a href="/vuepress-studynotes/notes/Nodejs/Expressjs/mongoose+MongoDB.html#enum" class="sidebar-link">enum</a></li><li class="sidebar-sub-header"><a href="/vuepress-studynotes/notes/Nodejs/Expressjs/mongoose+MongoDB.html#validate-自定义验证器" class="sidebar-link">validate 自定义验证器</a></li><li class="sidebar-sub-header"><a href="/vuepress-studynotes/notes/Nodejs/Expressjs/mongoose+MongoDB.html#获取所所有报错信息" class="sidebar-link">获取所所有报错信息</a></li></ul></li><li><a href="/vuepress-studynotes/notes/Nodejs/Expressjs/mongoose+MongoDB.html#集合关联-重要" class="sidebar-link">集合关联（重要）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress-studynotes/notes/Nodejs/Expressjs/mongoose+MongoDB.html#id-关联集合" class="sidebar-link">_id 关联集合</a></li><li class="sidebar-sub-header"><a href="/vuepress-studynotes/notes/Nodejs/Expressjs/mongoose+MongoDB.html#populate-查询关联" class="sidebar-link">populate() 查询关联</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="mongoose模块"><a href="#mongoose模块" class="header-anchor">#</a> mongoose模块</h1> <p>使用Node.js操作MongoDB数据库，需要依赖第三方包mongoose</p> <h2 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h2> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> i mongoose
</code></pre></div><h2 id="数据库连接"><a href="#数据库连接" class="header-anchor">#</a> 数据库连接</h2> <ol><li>启动MongoDB</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>brew services start mongodb-community
</code></pre></div><ol start="2"><li>链接数据库</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span>

mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'mongodb://localhost/my_db_01'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    useNewUrlParser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    useUnifiedTopology<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'mongodb链接成功'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'mongodb链接失败'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><table><thead><tr><th>解释</th> <th style="text-align:center;">SQL</th> <th style="text-align:center;">MongoDB</th> <th>解释</th></tr></thead> <tbody><tr><td>数据库</td> <td style="text-align:center;">database</td> <td style="text-align:center;"><strong>database</strong></td> <td><strong>数据库</strong></td></tr> <tr><td>数据表</td> <td style="text-align:center;">table</td> <td style="text-align:center;"><strong>collection</strong></td> <td><strong>集合</strong>（JS数组）</td></tr> <tr><td>数据行</td> <td style="text-align:center;">row</td> <td style="text-align:center;"><strong>document</strong></td> <td><strong>文档</strong>（JS对象）</td></tr> <tr><td>字段</td> <td style="text-align:center;">column</td> <td style="text-align:center;"><strong>field</strong></td> <td><strong>字段</strong>（JS对象属性）</td></tr> <tr><td>主键</td> <td style="text-align:center;">primary key</td> <td style="text-align:center;">primary key</td> <td>主键，自动将id字段设为主键</td></tr></tbody></table> <h2 id="创建集合"><a href="#创建集合" class="header-anchor">#</a> 创建集合</h2> <p>MongoDB中不需要手动创建数据库</p> <p>在链接数据库时，若数据库不存在，MongoDB会自动创建数据库</p> <ol><li><p><strong>创建集合规则</strong></p> <p>通过mongoose.Schema创建构造函数实例</p> <p>传入属性的数据类型</p> <p>MongoDB会自动创建 _id字段</p></li> <li><p><strong>使用规则创建集合</strong>，</p> <p>使用创建的规则并通过model() 方法创建集合</p> <p>集合首字母名称大写，存入数据库中集合的名称实为小写且加上了s</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 1. 创建集合规则</span>
<span class="token keyword">const</span> studentSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> String<span class="token punctuation">,</span>
    age<span class="token operator">:</span> Number<span class="token punctuation">,</span>
    isStatus<span class="token operator">:</span> Boolean
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 2. 创建集合</span>
<span class="token keyword">const</span> Student <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Student'</span><span class="token punctuation">,</span> studentSchema<span class="token punctuation">)</span>
</code></pre></div><p>但是，仅有集合还没插入数据，</p> <p>没有数据MongoDB无法自动创建数据库</p> <h2 id="创建并插入文档"><a href="#创建并插入文档" class="header-anchor">#</a> 创建并插入文档</h2> <h3 id="方法1-创建文档实例"><a href="#方法1-创建文档实例" class="header-anchor">#</a> 方法1  创建文档实例</h3> <p>创建文档实例对象，然后存入</p> <ol><li><p><strong>创建文档实例对象</strong>，添加对象形式数据</p> <p>添加的数据的属性和规则创建的一一对应</p></li> <li><p><strong>将数据存入数据库</strong></p> <p>通过集合实例对象的save方法</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 3. 创建文档</span>
<span class="token keyword">const</span> student <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'Andy'</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">28</span><span class="token punctuation">,</span>
    isStatus<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 4. 存入数据库</span>
student<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>综上：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 导入</span>
<span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span>
<span class="token comment">// 链接数据库</span>
mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'mongodb://localhost/my_db_01'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    useNewUrlParser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    useUnifiedTopology<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'mongodb链接成功'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'mongodb链接失败'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>


<span class="token comment">// 1. 创建规则</span>
<span class="token keyword">const</span> studentSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> String<span class="token punctuation">,</span>
    age<span class="token operator">:</span> Number<span class="token punctuation">,</span>
    isStatus<span class="token operator">:</span> Boolean
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 2. 创建集合</span>
<span class="token keyword">const</span> Student <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Student'</span><span class="token punctuation">,</span> studentSchema<span class="token punctuation">)</span>

<span class="token comment">// 3. 创建文档</span>
<span class="token keyword">const</span> student <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'Andy'</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">28</span><span class="token punctuation">,</span>
    isStatus<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 4. 存入数据库</span>
student<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="方法2-集合的create"><a href="#方法2-集合的create" class="header-anchor">#</a> 方法2  集合的create()</h3> <ol><li><p>通过集合实例对象的 create()方法 插入文档对象</p> <ul><li>第一个参数：对象形式的要插入的文档</li></ul></li> <li><p>然后通过 create()方法的<strong>回调函数获取插入文档的执行结果</strong></p> <ul><li>第二个参数：回调函数</li></ul></li></ol> <div class="language-js extra-class"><pre class="language-js"><code>Student<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'Tom'</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
    isStatus<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 错误对象</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 插入集合的当前文档</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span>

mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'mongodb://localhost/my_db_01'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    useNewUrlParser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    useUnifiedTopology<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'mongodb链接成功'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'mongodb链接失败'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>


<span class="token comment">// 1.</span>
<span class="token keyword">const</span> studentSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> String<span class="token punctuation">,</span>
    age<span class="token operator">:</span> Number<span class="token punctuation">,</span>
    isStatus<span class="token operator">:</span> Boolean
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 2.</span>
<span class="token keyword">const</span> Student <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Student'</span><span class="token punctuation">,</span> studentSchema<span class="token punctuation">)</span>

<span class="token comment">// 3.</span>
Student<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'Tom'</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
    isStatus<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><hr> <h3 id="create-的promise形式"><a href="#create-的promise形式" class="header-anchor">#</a> create() 的Promise形式</h3> <p>因为是异步回调函数，create() 方法可以使用Promise的形式</p> <ul><li>第一个参数：还是对象形式的要插入的文档</li></ul> <p>通过then() 获取插入执行的结果</p> <p>通过catch() 获取错误对象</p> <div class="language-js extra-class"><pre class="language-js"><code>Student<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'Tom'</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
    isStatus<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  	<span class="token comment">// 插入集合的当前文档</span>
  	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  	<span class="token comment">// 错误对象</span>
  	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span>

mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'mongodb://localhost/my_db_01'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    useNewUrlParser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    useUnifiedTopology<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'mongodb链接成功'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'mongodb链接失败'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>


<span class="token comment">// 1.</span>
<span class="token keyword">const</span> studentSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> String<span class="token punctuation">,</span>
    age<span class="token operator">:</span> Number<span class="token punctuation">,</span>
    isStatus<span class="token operator">:</span> Boolean
  	skills<span class="token operator">:</span> <span class="token punctuation">[</span>String<span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 2.</span>
<span class="token keyword">const</span> Student <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Student'</span><span class="token punctuation">,</span> studentSchema<span class="token punctuation">)</span>

<span class="token comment">// 3.</span>
<span class="token comment">// Promise形式</span>
Student<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'Jerry'</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
    isStatus<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="查询文档"><a href="#查询文档" class="header-anchor">#</a> 查询文档</h2> <h3 id="find-查询文档"><a href="#find-查询文档" class="header-anchor">#</a> find() 查询文档</h3> <p>通过集合的 find() 方法，</p> <ul><li><p>返一组文档（数组形式）</p></li> <li><p>若文档不存在，返回一个空数组 <strong>[ ]</strong></p></li></ul> <hr> <h4 id="查找所有文档"><a href="#查找所有文档" class="header-anchor">#</a> 查找所有文档</h4> <div class="language-js extra-class"><pre class="language-js"><code>Students<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 导入</span>
<span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span>
<span class="token comment">// 链接数据库</span>
mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'mongodb://localhost/my_db_01'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    useNewUrlParser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    useUnifiedTopology<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'mongodb链接成功'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'mongodb链接失败'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 创建集合规则</span>
<span class="token keyword">const</span> studentSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> String<span class="token punctuation">,</span>
    age<span class="token operator">:</span> Number<span class="token punctuation">,</span>
    isStatus<span class="token operator">:</span> Boolean<span class="token punctuation">,</span>
  	skills<span class="token operator">:</span> <span class="token punctuation">[</span>String<span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 使用规则创建集合</span>
<span class="token keyword">const</span> Student <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Student'</span><span class="token punctuation">,</span> studentSchema<span class="token punctuation">)</span>

<span class="token comment">// 查找</span>
Student<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="findone-查询文档"><a href="#findone-查询文档" class="header-anchor">#</a> findOne() 查询文档</h3> <p>返回一个文档（对象形式）</p> <p>默认集合中第一个符合条件的文档</p> <p>若不存在则返回<strong>null</strong></p> <hr> <h4 id="查询第一个文档"><a href="#查询第一个文档" class="header-anchor">#</a> 查询第一个文档</h4> <div class="language-js extra-class"><pre class="language-js"><code>Students<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><hr> <h4 id="查询第一个符合条件的文档"><a href="#查询第一个符合条件的文档" class="header-anchor">#</a> 查询第一个符合条件的文档</h4> <div class="language-js extra-class"><pre class="language-js"><code>Students<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  age<span class="token operator">:</span> <span class="token number">20</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="查询条件"><a href="#查询条件" class="header-anchor">#</a> 查询条件</h3> <h4 id="无条件"><a href="#无条件" class="header-anchor">#</a> 无条件</h4> <p>即，查找指定集合下的所有文档</p> <p>不给find() 方法传入对象形式的查询条件</p> <div class="language-js extra-class"><pre class="language-js"><code>Students<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><hr> <h4 id="固定值"><a href="#固定值" class="header-anchor">#</a> 固定值</h4> <p>即，查找指定集合下的，字段为指定的固定值的所有文档</p> <p>find() 方法传入对象形式的查询条件</p> <div class="language-js extra-class"><pre class="language-js"><code>Students<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  age<span class="token operator">:</span> <span class="token number">20</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><hr> <h4 id="范围值"><a href="#范围值" class="header-anchor">#</a> 范围值</h4> <p>即，查找指定集合下的，字段为指定的范围值的所有文档</p> <p>通过 $gt 和 $lt ，以对象形式指定查询条件字段值的范围</p> <ul><li>**$gt：**大于，great than</li> <li>**$lt：**小于，less than</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>Students<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  age<span class="token operator">:</span> <span class="token punctuation">{</span>
    $gt<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span> 
    $lt<span class="token operator">:</span> <span class="token number">40</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 导入</span>
<span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span>
<span class="token comment">// 链接数据库</span>
mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'mongodb://localhost/my_db_01'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    useNewUrlParser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    useUnifiedTopology<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'mongodb链接成功'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'mongodb链接失败'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 创建集合规则</span>
<span class="token keyword">const</span> studentSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> String<span class="token punctuation">,</span>
    age<span class="token operator">:</span> Number<span class="token punctuation">,</span>
    isStatus<span class="token operator">:</span> Boolean
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 使用规则创建集合</span>
<span class="token keyword">const</span> Student <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Student'</span><span class="token punctuation">,</span> studentSchema<span class="token punctuation">)</span>

<span class="token comment">// 查找</span>
Student<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    age<span class="token operator">:</span> <span class="token punctuation">{</span>
        $gt<span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span>
        $lt<span class="token operator">:</span> <span class="token number">30</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><hr> <h4 id="包含"><a href="#包含" class="header-anchor">#</a> 包含</h4> <p>即，查找指定集合下的，字段内容包含有某些指定值的所有文档</p> <p>通过 $in，以数组形式指定查询条件字段值应包含哪些值</p> <p>可用于查询关键字</p> <div class="language-js extra-class"><pre class="language-js"><code>Students<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  skills<span class="token operator">:</span> <span class="token punctuation">{</span>
    $<span class="token keyword">in</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'JS'</span><span class="token punctuation">,</span> <span class="token string">'PHP'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><hr> <h4 id="指定字段"><a href="#指定字段" class="header-anchor">#</a> 指定字段</h4> <p>即，查找指定集合下的，文档的某些指定字段</p> <p>通过在find()后链式调用select()，以空格字符串的形式传入指定字段</p> <div class="language-js extra-class"><pre class="language-js"><code>Students<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'name age'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>返回值除了指定的字段，还默认携带 _id字段</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span> _id<span class="token operator">:</span> <span class="token number">60</span>ce283a08d2840efd1ef7dd<span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'Andy'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> _id<span class="token operator">:</span> <span class="token number">60</span>ceccca20e099119ba24134<span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'Tom'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> _id<span class="token operator">:</span> <span class="token number">60</span>ced03079bf8411bc9f56a7<span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'Jerry'</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><hr> <h4 id="不指定某字段"><a href="#不指定某字段" class="header-anchor">#</a> 不指定某字段</h4> <p>若不想查询某字段，需要在其前加上 <strong>-</strong></p> <p>比如：不想查询默认显示的  _id字段</p> <div class="language-js extra-class"><pre class="language-js"><code>Students<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'name age -_id'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">[</span> 
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Andy'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> 
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Tom'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> 
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Jerry'</span> <span class="token punctuation">}</span> 
<span class="token punctuation">]</span>
</code></pre></div><hr> <h4 id="升序排序"><a href="#升序排序" class="header-anchor">#</a> 升序排序</h4> <p>将查询出来的数据，指定字段进行升序排序</p> <p>通过在find()后链式调用sort()，并将排序依据的字段用字符串形式传入</p> <div class="language-js extra-class"><pre class="language-js"><code>Student<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><hr> <h4 id="降序排序"><a href="#降序排序" class="header-anchor">#</a> 降序排序</h4> <p>在将排序依据的字段用字符串形式传入时，在前名加上 <strong>-</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>Student<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token string">'-age'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><hr> <h4 id="略过"><a href="#略过" class="header-anchor">#</a> 略过</h4> <p>通过 skip() 略过指定数量的文档</p> <p>和 limit()配合，可用于分页</p> <p>如下：略过前两个文档</p> <div class="language-js extra-class"><pre class="language-js"><code>Student<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><hr> <h4 id="限制数量"><a href="#限制数量" class="header-anchor">#</a> 限制数量</h4> <p>通过 limit() 限制查询的文档数量</p> <p>和skip()配合，可用于分页</p> <p>如下：查询10个的文档</p> <div class="language-js extra-class"><pre class="language-js"><code>Student<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="链式编程多个筛选条件"><a href="#链式编程多个筛选条件" class="header-anchor">#</a> 链式编程多个筛选条件</h3> <p>如下：</p> <ul><li>age在 20～30</li> <li>skills包含 Javascript, PHP</li> <li>查询前10个符合条件的人的name和score</li> <li>并按照score从大到小降序排列</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>Student
  <span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  	age<span class="token operator">:</span> <span class="token punctuation">{</span>
    	$gt<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
    	$lt<span class="token operator">:</span> <span class="token number">30</span>
  	<span class="token punctuation">}</span>
  	skills<span class="token operator">:</span> <span class="token punctuation">{</span>
    	$<span class="token keyword">in</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'JavaScript'</span><span class="token punctuation">,</span> <span class="token string">'PHP'</span><span class="token punctuation">]</span>
  	<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'name score -_id'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token string">'-score'</span><span class="token punctuation">)</span>
		<span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id=""><a href="#" class="header-anchor">#</a></h4> <h2 id="删除文档"><a href="#删除文档" class="header-anchor">#</a> 删除文档</h2> <h3 id="删除单个"><a href="#删除单个" class="header-anchor">#</a> 删除单个</h3> <p>通过 集合.findOneAndDelete() 删除单个文档</p> <p>查找匹配条件，并且删除符合条件的第一个文档</p> <p>then()返回的是删除的文档</p> <div class="language-js extra-class"><pre class="language-js"><code>Student<span class="token punctuation">.</span><span class="token function">findOneAndDelete</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
   _id<span class="token operator">:</span> <span class="token string">'60ced03079bf8411bc9f56a7'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 导入</span>
<span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span>
<span class="token comment">// 链接数据库</span>
mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'mongodb://localhost/my_db_01'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    useNewUrlParser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    useUnifiedTopology<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'mongodb链接成功'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'mongodb链接失败'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 创建集合规则</span>
<span class="token keyword">const</span> studentSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> String<span class="token punctuation">,</span>
    age<span class="token operator">:</span> Number<span class="token punctuation">,</span>
    isStatus<span class="token operator">:</span> Boolean
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 创建集合</span>
<span class="token keyword">const</span> Student <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Student'</span><span class="token punctuation">,</span> studentSchema<span class="token punctuation">)</span>

<span class="token comment">// 删除</span>
Student<span class="token punctuation">.</span><span class="token function">findOneAndDelete</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
   _id<span class="token operator">:</span> <span class="token string">'60ced03079bf8411bc9f56a7'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><hr> <h3 id="删除多个"><a href="#删除多个" class="header-anchor">#</a> 删除多个</h3> <p>通过 集合.deleteMany({}) 删除多个文档</p> <p>返回的是个对象</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span> 
  n<span class="token operator">:</span> 删除的文档数<span class="token punctuation">,</span> 
  ok<span class="token operator">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
</code></pre></div><p>若传入的是个空对象，则删除集合中所有的文档</p> <div class="language-js extra-class"><pre class="language-js"><code>Student<span class="token punctuation">.</span><span class="token function">deleteMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="更新文档"><a href="#更新文档" class="header-anchor">#</a> 更新文档</h2> <h3 id="更新一个"><a href="#更新一个" class="header-anchor">#</a> 更新一个</h3> <p>通过updateOne()，将查询条件选中的第一个文档的某个字段更新</p> <p>返回值是个对象</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  n<span class="token operator">:</span> 文档总数<span class="token punctuation">,</span> 
  nModified<span class="token operator">:</span> 修改的文档数<span class="token punctuation">,</span> 
  ok<span class="token operator">:</span> <span class="token number">1</span> 
<span class="token punctuation">}</span>
</code></pre></div><p>如下，将name为James的第一个文档的age改为9999</p> <div class="language-js extra-class"><pre class="language-js"><code>Student<span class="token punctuation">.</span><span class="token function">updateOne</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Andy'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> age<span class="token operator">:</span> <span class="token string">'9999'</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 导入</span>
<span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span>
<span class="token comment">// 链接数据库</span>
mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'mongodb://localhost/my_db_01'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    useNewUrlParser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    useUnifiedTopology<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'mongodb链接成功'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'mongodb链接失败'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 创建集合规则</span>
<span class="token keyword">const</span> studentSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> String<span class="token punctuation">,</span>
    age<span class="token operator">:</span> Number<span class="token punctuation">,</span>
    isStatus<span class="token operator">:</span> Boolean
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 创建集合</span>
<span class="token keyword">const</span> Student <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Student'</span><span class="token punctuation">,</span> studentSchema<span class="token punctuation">)</span>

<span class="token comment">// 更新</span>
Student<span class="token punctuation">.</span><span class="token function">updateOne</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Andy'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> age<span class="token operator">:</span> <span class="token string">'9999'</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="更新多个"><a href="#更新多个" class="header-anchor">#</a> 更新多个</h3> <p>通过updateOne()，将多个文档的某个字段更新</p> <p>返回值是个对象</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  n<span class="token operator">:</span> 文档总数<span class="token punctuation">,</span> 
  nModified<span class="token operator">:</span> 修改的文档数<span class="token punctuation">,</span> 
  ok<span class="token operator">:</span> <span class="token number">1</span> 
<span class="token punctuation">}</span>
</code></pre></div><p>如下，将所有文档的age改为999</p> <div class="language-js extra-class"><pre class="language-js"><code>Student<span class="token punctuation">.</span><span class="token function">updateMany</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> age<span class="token operator">:</span> <span class="token string">'9999'</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 导入</span>
<span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span>
<span class="token comment">// 链接数据库</span>
mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'mongodb://localhost/my_db_01'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    useNewUrlParser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    useUnifiedTopology<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'mongodb链接成功'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'mongodb链接失败'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 创建集合规则</span>
<span class="token keyword">const</span> studentSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> String<span class="token punctuation">,</span>
    age<span class="token operator">:</span> Number<span class="token punctuation">,</span>
    isStatus<span class="token operator">:</span> Boolean
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 创建集合</span>
<span class="token keyword">const</span> Student <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Student'</span><span class="token punctuation">,</span> studentSchema<span class="token punctuation">)</span>

<span class="token comment">// 更新</span>
Student<span class="token punctuation">.</span><span class="token function">updateMany</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> age<span class="token operator">:</span> <span class="token string">'9999'</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="mongoose验证规则"><a href="#mongoose验证规则" class="header-anchor">#</a> mongoose验证规则</h2> <p>创建集合规则时，可设置字段的验证规则</p> <p>若插入文档时验证不合格，不插入数据库</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> studentSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> String<span class="token punctuation">,</span>
      required<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      trim<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      minlength<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      maxlength<span class="token operator">:</span> <span class="token number">20</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  	age<span class="token operator">:</span> <span class="token punctuation">{</span>
  		type<span class="token operator">:</span> Number，
  		min<span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
      max<span class="token operator">:</span> <span class="token number">30</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
  	time<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> Date<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token operator">:</span> Date<span class="token punctuation">.</span>now
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="required"><a href="#required" class="header-anchor">#</a> required</h3> <hr> <h4 id="required-true"><a href="#required-true" class="header-anchor">#</a> required：true</h4> <p>创建集合规则中的字段默认是在创建文档时可有可没有</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> studentSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> String<span class="token punctuation">,</span>
      required<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><hr> <h4 id="自定义报错信息"><a href="#自定义报错信息" class="header-anchor">#</a> 自定义报错信息</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> studentSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> String<span class="token punctuation">,</span>
      required<span class="token operator">:</span>  <span class="token punctuation">[</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">'name字段是必须的'</span> <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="minlength-maxlength"><a href="#minlength-maxlength" class="header-anchor">#</a> minlength maxlength</h3> <p>字符串最小长度 最大长度</p> <p>如下；规定title字段的长度为 2～10</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> studentSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    title<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> String<span class="token punctuation">,</span>
      minlength<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      maxlength<span class="token operator">:</span> <span class="token number">20</span>
    <span class="token punctuation">}</span>                                     
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><hr> <h4 id="自定义错误信息"><a href="#自定义错误信息" class="header-anchor">#</a> 自定义错误信息</h4> <p>如下：自定义报错信息</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> studentSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    title<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> String<span class="token punctuation">,</span>
      minlength<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'长度不能小于2'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      maxlength<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">'长度不能大于20'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>                                     
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="trim"><a href="#trim" class="header-anchor">#</a> trim</h3> <h4 id="trim-true"><a href="#trim-true" class="header-anchor">#</a> trim: true</h4> <p>去除字符串两边的空格</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> studentSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    title<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> String<span class="token punctuation">,</span>
      trim<span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>                                     
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="min-max"><a href="#min-max" class="header-anchor">#</a> min max</h3> <p>数字的最小值 最大值</p> <p>如下：age字段的范围 18～30</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> studentSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  	age<span class="token operator">:</span> <span class="token punctuation">{</span>
  		type<span class="token operator">:</span> Number，
  		min<span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
      max<span class="token operator">:</span> <span class="token number">30</span>
		<span class="token punctuation">}</span>                                      
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="default"><a href="#default" class="header-anchor">#</a> default</h3> <p>默认值</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> studentSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  	time<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> Date<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token operator">:</span> Date<span class="token punctuation">.</span>now
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="enum"><a href="#enum" class="header-anchor">#</a> enum</h3> <p>限定只能传入指定的值，数组形式</p> <p>如下：category字段在创建文档时只能传入JavaScript和PHP两个值</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> studentSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  	category<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> String<span class="token punctuation">,</span>
      <span class="token keyword">enum</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'JavaScript'</span><span class="token punctuation">,</span><span class="token string">'PHP'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><hr> <h4 id="自定义错误信息-2"><a href="#自定义错误信息-2" class="header-anchor">#</a> 自定义错误信息</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> studentSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  	category<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> String<span class="token punctuation">,</span>
      <span class="token keyword">enum</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        values<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'JavaScript'</span><span class="token punctuation">,</span><span class="token string">'PHP'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        message<span class="token operator">:</span> <span class="token string">'自定义报错信息'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="validate-自定义验证器"><a href="#validate-自定义验证器" class="header-anchor">#</a> validate 自定义验证器</h3> <p>如下：规定name字段长度必须大于4，否则报错</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> studentSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> String<span class="token punctuation">,</span>
        validate<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token function-variable function">validator</span><span class="token operator">:</span> <span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> v <span class="token operator">&amp;&amp;</span> v<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">4</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            message<span class="token operator">:</span> <span class="token string">'自定义报错提示信息'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="获取所所有报错信息"><a href="#获取所所有报错信息" class="header-anchor">#</a> 获取所所有报错信息</h3> <p>通过Promise形式向数据库中集合插入文档时</p> <ul><li><p>then() 方法的参数获取的是执行成功的结果</p></li> <li><p>catch() 方法的参数获取的是报错对象</p></li></ul> <p>若是插入文档时因字段规则验证不通过导致的报错，</p> <p>可能会存在多个字段不符合验证规则的场合，</p> <p>所以想获取返回的报错信息，需要便遍历错误对象</p> <div class="language-js extra-class"><pre class="language-js"><code>Students<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  xxx<span class="token operator">:</span><span class="token string">'xxx'</span><span class="token punctuation">,</span>
  xxx<span class="token operator">:</span><span class="token string">'xxx'</span><span class="token punctuation">,</span>
  xxx<span class="token operator">:</span><span class="token string">'xxx'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  	<span class="token keyword">const</span> err <span class="token operator">=</span> error<span class="token punctuation">.</span>errors
    
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> attr <span class="token keyword">in</span> err<span class="token punctuation">)</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">[</span>attr<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'message'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="集合关联-重要"><a href="#集合关联-重要" class="header-anchor">#</a> 集合关联（重要）</h2> <p>不同集合之间是有关联的，比如：</p> <table><thead><tr><th style="text-align:center;">文章集合</th> <th style="text-align:center;">用户信息集合</th></tr></thead> <tbody><tr><td style="text-align:center;">_id</td> <td style="text-align:center;">_id</td></tr> <tr><td style="text-align:center;">title</td> <td style="text-align:center;">name</td></tr> <tr><td style="text-align:center;">author</td> <td style="text-align:center;">age</td></tr></tbody></table> <p>信息量特别多时，没有必要将所有信息写入一个集合</p> <p>一般时通过 _id字段对不同集合进行关联</p> <h3 id="id-关联集合"><a href="#id-关联集合" class="header-anchor">#</a> _id 关联集合</h3> <ol><li><p>使用 _id 字段对不同集合进行关联</p> <p>将用户集合的_id 字段的值，作为文章集合的author字段的值</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span>
mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'mongodb://localhost/mydb_01'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    useNewUrlParser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    useUnifiedTopology<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'mongodb链接成功'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'mongodb链接失败'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>


<span class="token comment">//  1. 创建 User 用户集合</span>
<span class="token keyword">const</span> User <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> String<span class="token punctuation">,</span>
    age<span class="token operator">:</span> Number
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 2. 创建 Composition 文章集合</span>
<span class="token keyword">const</span> Composition <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'Composition'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    title<span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token comment">// 通过 _id字段关联集合</span>
    author<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> mongoose<span class="token punctuation">.</span>Schema<span class="token punctuation">.</span>Types<span class="token punctuation">.</span>ObjectId<span class="token punctuation">,</span><span class="token comment">// _id字段的数据类型</span>
        ref<span class="token operator">:</span> <span class="token string">'User'</span>  <span class="token comment">// 要关联的集合</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 3. User集合 创建插入文档</span>
User<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'Andy'</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">28</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 4. Composition集合 创建插入文档</span>
Composition<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    title<span class="token operator">:</span> <span class="token string">'No1'</span><span class="token punctuation">,</span>
    author<span class="token operator">:</span> <span class="token string">'60cf0a3f274c6b1792dc90e8'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>


<span class="token comment">// 查询</span>
Composition
    <span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// .populate('author')</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><p>但是，这样查询的结果并没有讲两个集合关联起来</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    _id<span class="token operator">:</span> <span class="token number">60</span>cf0b24cf58d017a123548b<span class="token punctuation">,</span>
    title<span class="token operator">:</span> <span class="token string">'No1'</span><span class="token punctuation">,</span>
    author<span class="token operator">:</span> <span class="token number">60</span>cf0a3f274c6b1792dc90e8<span class="token punctuation">,</span>
    __v<span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><h3 id="populate-查询关联"><a href="#populate-查询关联" class="header-anchor">#</a> populate() 查询关联</h3> <p>所以查询时需要通过 populate()</p> <div class="language-js extra-class"><pre class="language-js"><code>集合<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">populate</span><span class="token punctuation">(</span><span class="token string">'关联的字段'</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>  
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    _id<span class="token operator">:</span> <span class="token number">60</span>cf0b24cf58d017a123548b<span class="token punctuation">,</span>
    title<span class="token operator">:</span> <span class="token string">'No1'</span><span class="token punctuation">,</span>
    author<span class="token operator">:</span> <span class="token punctuation">{</span> 
    		_id<span class="token operator">:</span> <span class="token number">60</span>cf0a3f274c6b1792dc90e8<span class="token punctuation">,</span> 
    		name<span class="token operator">:</span> <span class="token string">'Andy'</span><span class="token punctuation">,</span> 
    		age<span class="token operator">:</span> <span class="token number">28</span><span class="token punctuation">,</span> 
    		__v<span class="token operator">:</span> <span class="token number">0</span> 
  	<span class="token punctuation">}</span><span class="token punctuation">,</span>
    __v<span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">10/25/2021, 4:53:25 AM</span></div></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/vuepress-studynotes/assets/js/app.c0f0cecf.js" defer></script><script src="/vuepress-studynotes/assets/js/2.4e3782e5.js" defer></script><script src="/vuepress-studynotes/assets/js/36.6d59d549.js" defer></script>
  </body>
</html>
