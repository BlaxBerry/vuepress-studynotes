<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Node.js | StudyNotes</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Program Study Notes">
    
    <link rel="preload" href="/vuepress-studynotes/assets/css/0.styles.c3c52627.css" as="style"><link rel="preload" href="/vuepress-studynotes/assets/js/app.0e9e348b.js" as="script"><link rel="preload" href="/vuepress-studynotes/assets/js/2.5f9531f9.js" as="script"><link rel="preload" href="/vuepress-studynotes/assets/js/22.e2575d2d.js" as="script"><link rel="prefetch" href="/vuepress-studynotes/assets/js/10.054a8215.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/11.3dd98883.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/12.2690407b.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/13.e3730d14.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/14.1d3fcdf1.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/15.e8061062.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/16.2753b45f.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/17.9a3c5759.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/18.a86cefcd.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/19.d002909b.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/20.be0df537.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/21.c59c8d9f.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/23.ab25bfe8.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/24.dcc66664.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/25.c97eb640.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/26.1f1debbc.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/27.e1df4df4.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/28.ec64c5a2.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/29.73c25880.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/3.924f20aa.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/4.e8c26340.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/5.df4249d8.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/6.effa9b2b.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/7.6583d4f4.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/8.60714bcb.js"><link rel="prefetch" href="/vuepress-studynotes/assets/js/9.15bfdf97.js">
    <link rel="stylesheet" href="/vuepress-studynotes/assets/css/0.styles.c3c52627.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepress-studynotes/" class="home-link router-link-active"><!----> <span class="site-name">StudyNotes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vuepress-studynotes/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/vuepress-studynotes/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Links" class="dropdown-title"><span class="title">Links</span> <span class="arrow down"></span></button> <button type="button" aria-label="Links" class="mobile-dropdown-title"><span class="title">Links</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/BlaxBerry" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blaxberry.github.io/#/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Portfolio
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vuepress-studynotes/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/vuepress-studynotes/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Links" class="dropdown-title"><span class="title">Links</span> <span class="arrow down"></span></button> <button type="button" aria-label="Links" class="mobile-dropdown-title"><span class="title">Links</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/BlaxBerry" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://blaxberry.github.io/#/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Portfolio
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Node.js</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vuepress-studynotes/nodejs/Node.js-Basic.html#node-js简介" class="sidebar-link">Node.js简介</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-studynotes/nodejs/Node.js-Basic.html#环境安装" class="sidebar-link">环境安装</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress-studynotes/nodejs/Node.js-Basic.html#版本区分" class="sidebar-link">版本区分</a></li><li class="sidebar-sub-header"><a href="/vuepress-studynotes/nodejs/Node.js-Basic.html#版本号查看" class="sidebar-link">版本号查看</a></li></ul></li><li><a href="/vuepress-studynotes/nodejs/Node.js-Basic.html#javascript运行环境" class="sidebar-link">JavaScript运行环境</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress-studynotes/nodejs/Node.js-Basic.html#_1-浏览器运行环境" class="sidebar-link">1. 浏览器运行环境</a></li><li class="sidebar-sub-header"><a href="/vuepress-studynotes/nodejs/Node.js-Basic.html#_2-node-js运行环境" class="sidebar-link">2. Node.js运行环境</a></li></ul></li><li><a href="/vuepress-studynotes/nodejs/Node.js-Basic.html#全局对象global" class="sidebar-link">全局对象global</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-studynotes/nodejs/Node.js-Basic.html#fs-内置文件系统模块" class="sidebar-link">fs  内置文件系统模块</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress-studynotes/nodejs/Node.js-Basic.html#fs-readfile" class="sidebar-link">fs.readFile()</a></li><li class="sidebar-sub-header"><a href="/vuepress-studynotes/nodejs/Node.js-Basic.html#fs-writefile" class="sidebar-link">fs.writeFile()</a></li><li class="sidebar-sub-header"><a href="/vuepress-studynotes/nodejs/Node.js-Basic.html#练习实例" class="sidebar-link">练习实例</a></li><li class="sidebar-sub-header"><a href="/vuepress-studynotes/nodejs/Node.js-Basic.html#相对路径导致动态拼接问题" class="sidebar-link">相对路径导致动态拼接问题</a></li><li class="sidebar-sub-header"><a href="/vuepress-studynotes/nodejs/Node.js-Basic.html#dirname" class="sidebar-link">__dirname</a></li></ul></li><li><a href="/vuepress-studynotes/nodejs/Node.js-Basic.html#path-内置路径模块" class="sidebar-link">path 内置路径模块</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress-studynotes/nodejs/Node.js-Basic.html#path-join" class="sidebar-link">path.join()</a></li><li class="sidebar-sub-header"><a href="/vuepress-studynotes/nodejs/Node.js-Basic.html#path-basename" class="sidebar-link">path.basename()</a></li><li class="sidebar-sub-header"><a href="/vuepress-studynotes/nodejs/Node.js-Basic.html#path-extname" class="sidebar-link">path.extname()</a></li><li class="sidebar-sub-header"><a href="/vuepress-studynotes/nodejs/Node.js-Basic.html#练习实例-2" class="sidebar-link">练习实例</a></li></ul></li><li><a href="/vuepress-studynotes/nodejs/Node.js-Basic.html#http-内置模块" class="sidebar-link">http 内置模块</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress-studynotes/nodejs/Node.js-Basic.html#创建web服务器" class="sidebar-link">创建web服务器</a></li><li class="sidebar-sub-header"><a href="/vuepress-studynotes/nodejs/Node.js-Basic.html#server-on" class="sidebar-link">server.on()</a></li><li class="sidebar-sub-header"><a href="/vuepress-studynotes/nodejs/Node.js-Basic.html#简单路由" class="sidebar-link">简单路由</a></li><li class="sidebar-sub-header"><a href="/vuepress-studynotes/nodejs/Node.js-Basic.html#静态资源访问" class="sidebar-link">静态资源访问</a></li></ul></li><li><a href="/vuepress-studynotes/nodejs/Node.js-Basic.html#url-内置模块" class="sidebar-link">url 内置模块</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-studynotes/nodejs/Node.js-Basic.html#querystring-内置模块" class="sidebar-link">querystring 内置模块</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-studynotes/nodejs/Node.js-Basic.html#模块化" class="sidebar-link">模块化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress-studynotes/nodejs/Node.js-Basic.html#模块化概念" class="sidebar-link">模块化概念</a></li><li class="sidebar-sub-header"><a href="/vuepress-studynotes/nodejs/Node.js-Basic.html#node-js中模块的分类" class="sidebar-link">Node.js中模块的分类</a></li><li class="sidebar-sub-header"><a href="/vuepress-studynotes/nodejs/Node.js-Basic.html#模块的加载机制" class="sidebar-link">模块的加载机制</a></li></ul></li><li><a href="/vuepress-studynotes/nodejs/Node.js-Basic.html#commonjs规范" class="sidebar-link">CommonJS规范</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress-studynotes/nodejs/Node.js-Basic.html#commonjs-加载模块" class="sidebar-link">CommonJS - 加载模块</a></li><li class="sidebar-sub-header"><a href="/vuepress-studynotes/nodejs/Node.js-Basic.html#模块作用域" class="sidebar-link">模块作用域</a></li><li class="sidebar-sub-header"><a href="/vuepress-studynotes/nodejs/Node.js-Basic.html#commonjs-暴露模块成员" class="sidebar-link">CommonJS - 暴露模块成员</a></li></ul></li><li><a href="/vuepress-studynotes/nodejs/Node.js-Basic.html#第三方模块" class="sidebar-link">第三方模块</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vuepress-studynotes/nodejs/Node.js-Basic.html#node-js的异步" class="sidebar-link">Node.js的异步</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress-studynotes/nodejs/Node.js-Basic.html#异步嵌套-回调地狱" class="sidebar-link">异步嵌套（回调地狱）</a></li><li class="sidebar-sub-header"><a href="/vuepress-studynotes/nodejs/Node.js-Basic.html#promise解决回调地狱" class="sidebar-link">Promise解决回调地狱</a></li><li class="sidebar-sub-header"><a href="/vuepress-studynotes/nodejs/Node.js-Basic.html#async异步函数解决回调地狱" class="sidebar-link">async异步函数解决回调地狱</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="node-js"><a href="#node-js" class="header-anchor">#</a> Node.js</h1> <img src="https://www.fusionia.jp/wp-content/uploads/2018/06/node-js-736399_960_720.png" style="zoom:50%;"> <p>Node.js是个基于Chrome V8 引擎的JavaSCript运行环境</p> <h2 id="node-js简介"><a href="#node-js简介" class="header-anchor">#</a> Node.js简介</h2> <p>作为是一个JS的运行环境，是一个底层的东西</p> <p>虽然Node.js仅提供了基础功能+内置API，</p> <p>但基于Node.js的各种工具、框架很重要，比如：</p> <ul><li><strong>Express框架</strong>：快速构建Web应用</li> <li><strong>Electron框架</strong>：构建跨平台桌面应用</li> <li><strong>restift框架</strong>：快速构建API接口项目</li> <li><strong>读写操作数据库</strong></li> <li>创建各种命令行工具</li></ul> <hr> <p><strong>建议流程：</strong></p> <ol><li><p>JS基础语法</p></li> <li><p>内置API模块</p></li> <li><p>第三方模块（express，mysql）</p></li></ol> <h2 id="环境安装"><a href="#环境安装" class="header-anchor">#</a> 环境安装</h2> <p>可通过官方网站指定版本下载</p> <p>也可通过npm安装NVM版本管理器下载</p> <hr> <h3 id="版本区分"><a href="#版本区分" class="header-anchor">#</a> 版本区分</h3> <p><strong>LTS版本</strong>：长期稳定版，适合企业级项目</p> <p><strong>Current版本</strong>：新特性测试尝鲜版，可能存在隐藏Bug漏洞</p> <hr> <h3 id="版本号查看"><a href="#版本号查看" class="header-anchor">#</a> 版本号查看</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>node -v
</code></pre></div><h2 id="javascript运行环境"><a href="#javascript运行环境" class="header-anchor">#</a> JavaScript运行环境</h2> <p>JS可以运行在浏览器（前端开发），</p> <p>还可以运行在基于JS解析引擎的Node.js上（后端开发）</p> <hr> <hr> <h3 id="_1-浏览器运行环境"><a href="#_1-浏览器运行环境" class="header-anchor">#</a> 1. 浏览器运行环境</h3> <p>浏览器是JS的<strong>前端运行环境</strong></p> <p>浏览器都内置JS解析引擎，其中Chrome浏览器的V8引擎效率最高</p> <ul><li><p>JS解析引擎</p></li> <li><p>运行环境提供的内置API</p> <p>（DOM、BOM、Canvas、XMLHttpRequest、JS内置对象...）</p></li></ul> <hr> <hr> <h3 id="_2-node-js运行环境"><a href="#_2-node-js运行环境" class="header-anchor">#</a> 2. Node.js运行环境</h3> <p>Node.js是JS的<strong>后端运行环境</strong></p> <p><strong>Node.js中无法调用浏览器提供的DOM，BOM，Ajax等API函数</strong></p> <ul><li><p>V8引擎</p></li> <li><p>运行环境提供的内置API</p> <p>（fs、path、http、querystring、JS内置对象...）</p></li></ul> <hr> <p>在JavaScript文件目录下打开终端</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> JS文件存放目录
node JS文件名
</code></pre></div><p>如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// JS 文件</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello Node.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">20</span>
<span class="token keyword">var</span> c <span class="token operator">=</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 终端</span>
node test.js

Hello Node.js
<span class="token number">30</span>
</code></pre></div><h2 id="全局对象global"><a href="#全局对象global" class="header-anchor">#</a> 全局对象global</h2> <p>Node.js这个JS运行环境中没有DOM和BOM，</p> <p>在浏览器JS运行环境中的全局对象是window</p> <p>在Node.js运行环境中的全局对象是global</p> <p>Node.js中的global中的方法可以省略global</p> <ul><li><strong>console.log()</strong></li> <li><strong>setTimeout()</strong></li> <li><strong>clearTimout()</strong></li> <li><strong>setInterval()</strong></li> <li><strong>claerInterval()</strong></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>global<span class="token punctuation">.</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'i am Global.console.log()'</span><span class="token punctuation">)</span>

global<span class="token punctuation">.</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">2000</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="fs-内置文件系统模块"><a href="#fs-内置文件系统模块" class="header-anchor">#</a> fs  内置文件系统模块</h2> <p>fs模块是Node.js提供的内置模块</p> <p>可用于<strong>文件操作</strong></p> <ul><li><p><strong>fs.readFile()</strong></p> <p>读取指定文件内容</p></li> <li><p><strong>fs.writeFile()</strong></p> <p>向指定文件写入内容</p></li></ul> <hr> <p>在JS文件中向使用fs模块，要先通过require导入模块</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="fs-readfile"><a href="#fs-readfile" class="header-anchor">#</a> fs.readFile()</h3> <div class="language-js extra-class"><pre class="language-js"><code>fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'文件路径'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'编码格式'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 回调函数<span class="token punctuation">)</span>
</code></pre></div><ul><li><p>文件路径（必须）</p> <p>字符串形式</p></li> <li><p>编码格式（可选）</p> <p>表示以什么编码格式读取文件，</p> <p>常用 <strong>utf8</strong></p></li> <li><p>回调函数（必须）</p> <p>文件读取完后，通过回调函数的参数拿到读取结果</p> <p><strong>err</strong>：读取失败的错误对象，错误原因存放在<strong>err.massage</strong></p> <p><strong>data</strong>：读取成功的文件内容</p> <p>错误优先，err在data前面</p></li></ul> <hr> <h4 id="返回结果"><a href="#返回结果" class="header-anchor">#</a> 返回结果</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// JS文件</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./01.txt'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'--------'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// txt 文件</span>
Hello
<span class="token number">1.</span>apple
<span class="token number">2.</span>banana
</code></pre></div><ul><li>读取成功时：</li></ul> <p>err存的是<strong>null</strong>，</p> <p>data存的是目标文件的内容</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 终端显示</span>
null

--------

Hello
<span class="token number">1</span>.apple
<span class="token number">2</span>.banana
</code></pre></div><ul><li>读取失败时：</li></ul> <p>err中的存是错误对象，错误原因存放在<strong>err.massage</strong></p> <p>data中存的是<strong>undefined</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">[</span>Error: ENOENT: no such <span class="token function">file</span> or directory, <span class="token function">open</span> <span class="token string">'./011111111.txt'</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
  errno: -2,
  code: <span class="token string">'ENOENT'</span>,
  syscall: <span class="token string">'open'</span>,
  path: <span class="token string">'./011111111.txt'</span>
<span class="token punctuation">}</span>

--------

undefined
</code></pre></div><hr> <h4 id="判断文件读取成功或失败"><a href="#判断文件读取成功或失败" class="header-anchor">#</a> 判断文件读取成功或失败</h4> <p>因为，</p> <p>文件读取成功时，回调函数的参数err存的是<strong>null</strong>，</p> <p>文件读取失败时，回调函数的参数errerr中的存是错误对象</p> <p>所以可以通过判断err是否为<strong>true</strong>（不是null，是个包含错误信息的对象），</p> <p>来判断文件读取的成功或失败</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./0111111.txt'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'文件读取失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'文件读取成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 读取失败时</span>
文件读取失败
ENOENT: no such <span class="token function">file</span> or directory, <span class="token function">open</span> <span class="token string">'./0111111.txt'</span>
</code></pre></div><hr> <h4 id="读取html页面文件"><a href="#读取html页面文件" class="header-anchor">#</a> 读取HTML页面文件</h4> <p>结合后面的path模块，可读取HTML页面文件中的所有结构内容</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./index.html'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="fs-writefile"><a href="#fs-writefile" class="header-anchor">#</a> fs.writeFile()</h3> <p><strong>只能用来创建文件不能创建目录</strong>，不然会报错路径错误</p> <p>重复调用fs.writeFile()时，<strong>新内容会覆盖旧内容</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">'文件路径'</span><span class="token punctuation">,</span> 写入内容<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'编码格式'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 回调函数<span class="token punctuation">)</span>
</code></pre></div><ul><li><p>文件路径（必须）</p> <p>字符串形式</p></li> <li><p>写入内容（必须）</p></li> <li><p>编码格式（可选）</p> <p>表示以什么编码格式写入内容，</p> <p>常用 <strong>utf8</strong></p></li> <li><p>回调函数（必须）</p> <p>内容写入完后执行</p> <p><strong>err</strong>：写入失败的错误对象，错误原因存放在<strong>err.massage</strong></p></li></ul> <hr> <h4 id="返回结果-2"><a href="#返回结果-2" class="header-anchor">#</a> 返回结果</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token string">'Hello'</span>
fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">'./02/txt'</span><span class="token punctuation">,</span>content<span class="token punctuation">,</span><span class="token string">'utf8'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>文件写入成功时：</li></ul> <p>err是<strong>null</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">null</span>
</code></pre></div><ul><li>文件写入失败时：</li></ul> <p>err是错误对象，错误原因存放在<strong>err.massage</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">[</span>Error<span class="token operator">:</span> <span class="token constant">ENOENT</span><span class="token operator">:</span> no such file or directory<span class="token punctuation">,</span> open <span class="token string">'./02/txt'</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
  errno<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span>
  code<span class="token operator">:</span> <span class="token string">'ENOENT'</span><span class="token punctuation">,</span>
  syscall<span class="token operator">:</span> <span class="token string">'open'</span><span class="token punctuation">,</span>
  path<span class="token operator">:</span> <span class="token string">'./02/txt'</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <h4 id="判断文件写入成功或失败"><a href="#判断文件写入成功或失败" class="header-anchor">#</a> 判断文件写入成功或失败</h4> <p>因为，</p> <p>文件写入成功时，err是<strong>null</strong>，</p> <p>文件写入失败时，err是个错误对象</p> <p>所以可以通过判断err是否为<strong>true</strong>（不是null，是个包含错误信息的对象），</p> <p>来判断文件读取的成功或失败</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token string">'Hello'</span>
fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">'./02/txt'</span><span class="token punctuation">,</span>content<span class="token punctuation">,</span><span class="token string">'utf8'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'文件写入失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
      	<span class="token keyword">return</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'文件写入成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 读取失败时</span>
文件写入失败
ENOENT: no such <span class="token function">file</span> or directory, <span class="token function">open</span> <span class="token string">'./02/txt'</span>
</code></pre></div><h3 id="练习实例"><a href="#练习实例" class="header-anchor">#</a> 练习实例</h3> <p>获取文件内容进行整理，然后存入新的文件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 整理前的内容</span>
andy<span class="token operator">=</span><span class="token number">99</span> Tom<span class="token operator">=</span><span class="token number">80</span> Jerry<span class="token operator">=</span><span class="token number">95</span> Jame<span class="token operator">=</span><span class="token number">40</span>

<span class="token comment">// 需要整理成如下，然后存入新文件：</span>
andy <span class="token operator">:</span> <span class="token number">99</span> 
Tom <span class="token operator">:</span> <span class="token number">80</span> 
Jerry <span class="token operator">:</span> <span class="token number">95</span> 
Jame <span class="token operator">:</span> <span class="token number">40</span>
</code></pre></div><ol><li>先fs.readFile()读取</li> <li>然后处理，字符串——&gt;数组，替换字符后——&gt;字符串</li> <li>最后fs.writrFile()写入新文件</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./01.txt'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'读取失败'</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
      	<span class="token keyword">return</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'读取成功'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 1. 转为数组</span>
        <span class="token keyword">const</span> oldData <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2. 替换 = 为 ：， 并存入新数组</span>
        <span class="token keyword">const</span> newData <span class="token operator">=</span> oldData<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> item<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">,</span> <span class="token string">':'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token comment">// 3. 新数组转为字符串，并换行</span>
        <span class="token keyword">const</span> resData <span class="token operator">=</span> newData<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'\r\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 4. 调用函数写入文件</span>
        <span class="token function">fun</span><span class="token punctuation">(</span>resData<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">fun</span><span class="token punctuation">(</span><span class="token parameter">content</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">'./学生成绩.txt'</span><span class="token punctuation">,</span> content<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'写入失败'</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
         	  <span class="token keyword">return</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'写入成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="相对路径导致动态拼接问题"><a href="#相对路径导致动态拼接问题" class="header-anchor">#</a> 相对路径导致动态拼接问题</h3> <p><strong>因为Node.js中的相对路径，相对的不是工作目录，</strong>( require( )例外 )</p> <p><strong>相对的是指向命令行工具时所在的目录</strong></p> <p>于是，</p> <p>若 fs模块的方法中路径写的是<strong>相对路径</strong>的 <strong>./</strong> 或 <strong>../</strong></p> <p>则最终被拼接成的路径是</p> <p>执行Node.js命令的当前所在目录路径 + 被操作文件的路径</p> <p>最终，出现路径动态拼接错误问题，导致找不到文件</p> <p>所以，</p> <p>为了避免路径错误，使用fs模块操作文件时一般要使用<strong>绝对路径</strong></p> <p>即从目标文件的盘符开始写</p> <h3 id="dirname"><a href="#dirname" class="header-anchor">#</a> __dirname</h3> <p>因为绝对路径是从目标文件的盘符开始写，太麻烦</p> <p>且不同系统window 和 linux中的的层级 \ /不同，</p> <p>所以不应该自己手写文件存放路径，而是采用</p> <p>Node.js 的 <strong>__dirname</strong> (双下划线) 获取文件所在目录然后拼接文件名</p> <p><strong>以后路径path属性都要用__dirname拼接绝对路径</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">)</span>

__dirname <span class="token operator">+</span> <span class="token string">'/文件名'</span>
</code></pre></div><p>如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/01.txt'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'文件读取失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'文件读取成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token string">'Hello'</span>
fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/02.txt'</span><span class="token punctuation">,</span> content<span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'文件写入失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'文件写入成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="path-内置路径模块"><a href="#path-内置路径模块" class="header-anchor">#</a> path 内置路径模块</h2> <p>path模块是Node.js提供的内置模块</p> <p>可用于<strong>路径操作</strong></p> <ul><li><p><strong>path.join()</strong></p> <p>将多个路径片段 拼接为一个字符串路径，</p> <p>代替不正规的 +号拼接字符串的方法</p></li> <li><p><strong>path.basename()</strong></p> <p>获取路径字符串中的文件名</p></li> <li><p><strong>path.extname()</strong></p> <p>获取路径字符串中文件的扩展名</p></li></ul> <hr> <p>在JS文件中向使用path模块，要先通过require导入模块</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="path-join"><a href="#path-join" class="header-anchor">#</a> path.join()</h3> <p>用于拼接字符串的路径</p> <p><strong>Node.js的所有的路径拼接全部都要用path.join()</strong>，</p> <p>而不是用 +拼接字符串</p> <p>路径片段用逗号分隔，返回值是拼接后的路径字符串</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'/路径1'</span><span class="token punctuation">,</span><span class="token string">'/路径2'</span><span class="token punctuation">,</span><span class="token string">'/路径3'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
	/路径1/路径2/路径3
*/</span>
</code></pre></div><hr> <h4 id="抵消路径"><a href="#抵消路径" class="header-anchor">#</a> ../ 抵消路径</h4> <p><strong>../</strong>  抵消掉前面的一层路径片段</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'/路径1'</span><span class="token punctuation">,</span><span class="token string">'/路径2'</span><span class="token punctuation">,</span><span class="token string">'../'</span><span class="token punctuation">,</span><span class="token string">'/路径3'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
	/路径1/路径3
*/</span>


console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'/路径1'</span><span class="token punctuation">,</span><span class="token string">'/路径2'</span><span class="token punctuation">,</span><span class="token string">'../../'</span><span class="token punctuation">,</span><span class="token string">'/路径3'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
	/路径3
*/</span>


console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'/路径1'</span><span class="token punctuation">,</span><span class="token string">'/路径2/路径3'</span><span class="token punctuation">,</span><span class="token string">'../../'</span><span class="token punctuation">,</span><span class="token string">'/路径4'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/*
	/路径1/路径3
*/</span>
</code></pre></div><hr> <h4 id="拼接文件绝对路径"><a href="#拼接文件绝对路径" class="header-anchor">#</a> 拼接文件绝对路径</h4> <p>结合 <strong>__dirname</strong> 拼接文件绝对路径</p> <p>且，path.join() 在拼接相对路径时会自动去掉相对路径前面的  <strong>.</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'/文件.txt'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./文件.txt'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* 
/Users/chen/StudyPractice/JS/path/文件.txt
/Users/chen/StudyPractice/JS/path/文件.txt
*/</span>
</code></pre></div><p>如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'文件.txt'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'文件读取失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'文件读取成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="path-basename"><a href="#path-basename" class="header-anchor">#</a> path.basename()</h3> <p>可以获取一字符串段路径中的最后一部分</p> <p>常用来获取绝对路径中的<strong>文件名</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span><span class="token string">'路径'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'.文件后缀'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><ul><li><p>文件后缀</p> <p>没有该参数时（默认），返回值是文件名+后缀名</p> <p>有该参数时，返回值会仅文件名不包含后缀名</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> fullPath <span class="token operator">=</span> <span class="token string">'/Users/chen/StudyPractice/JS/path/文件.html'</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>fullPath<span class="token punctuation">,</span> <span class="token string">'.html'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 文件.html</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>fullPath<span class="token punctuation">,</span> <span class="token string">'.html'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 文件名</span>
</code></pre></div><h3 id="path-extname"><a href="#path-extname" class="header-anchor">#</a> path.extname()</h3> <p>可以获取一字符串段路径中的扩展名部分</p> <p>常用来获取绝对路径中的文件的<strong>后缀名</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> fullPath <span class="token operator">=</span> <span class="token string">'/Users/chen/StudyPractice/JS/path/文件.html'</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span>fullPath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// .html</span>
</code></pre></div><p>结合<strong>path.basename()</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fullPath <span class="token operator">=</span> <span class="token string">'/Users/chen/StudyPractice/JS/path/文件.html'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> ext <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span>fullPath<span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>fullPath<span class="token punctuation">,</span> ext<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 文件</span>
</code></pre></div><h3 id="练习实例-2"><a href="#练习实例-2" class="header-anchor">#</a> 练习实例</h3> <p>拆分一个完整 HTML文件，</p> <p>拆分为HTML文件、CSS文件、JS文件，并存放到指定目录下</p> <p>并通过外链方式将拆分出的CSS文件、JS文件引入拆分出的HTML文件</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>IE=edge<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
        <span class="token selector">*</span> <span class="token punctuation">{</span>
            <span class="token property">padding</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
            <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
            <span class="token property">box-sizing</span><span class="token punctuation">:</span> border-box<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token selector">#title</span> <span class="token punctuation">{</span>
            <span class="token property">font-size</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
            <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>title<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        <span class="token keyword">const</span> h <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        h<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'Hello'</span><span class="token punctuation">;</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ol><li><p>通过<strong>正则表达式</strong></p> <p>匹配获得完整HTML页面文件中的 <strong>&lt;style&gt;标签</strong> 和 <strong>&lt;script&gt;标签</strong></p></li> <li><p>通过fs模块读取完整的页面文件</p></li> <li><p>html页面文件内容中替换去掉正则匹配的内容 &lt;style&gt;标签 和 &lt;script&gt;标签</p></li> <li><p>通过fs模块将正则匹配的内容替换掉首尾标签后分别写入HTML文件、CSS文件</p></li></ol> <p><a href="https://github.com/BlaxBerry/Demo_Node.js/tree/master/splitPage" target="_blank" rel="noopener noreferrer">拆分完整HTML页面为.html , .css , .js文件<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="http-内置模块"><a href="#http-内置模块" class="header-anchor">#</a> http 内置模块</h2> <p>http模块是Node.js提供的内置模块</p> <p>用来创建web服务器</p> <p>Node.js中不需要通过IIS，Apache等web服务器软件，</p> <p>通过内置http模块的代码手写一个服务器软件，提供web服务</p> <ul><li><p><strong>http.createServer()</strong></p> <p>可将一个普通电脑变为可以向外提供Web资源的Web服务器</p></li></ul> <hr> <p>在JS文件中向使用http模块，要先通过require导入模块</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="创建web服务器"><a href="#创建web服务器" class="header-anchor">#</a> 创建web服务器</h3> <ol><li><p>导入http模块</p></li> <li><p>创建web服务器实例</p></li> <li><p>给服务器实例绑定request事件监听客户端请求</p></li> <li><p>监听端口启动服务器</p> <p>终端中用node打开该JS文件</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'有客户端来访问服务器了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'服务器运行在http://127.0.0.7:3000'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="server-on"><a href="#server-on" class="header-anchor">#</a> server.on()</h3> <p><strong>server.on()</strong> 中给服务器绑定的<strong>request事件处理函数</strong></p> <p>只要服务器收到了客户端请求，</p> <p>就可以通过request事件获得客户端相关的数据</p> <hr> <h4 id="req请求对象"><a href="#req请求对象" class="header-anchor">#</a> req请求对象</h4> <p>包含客户端相关的数据和属性</p> <ul><li><p><strong>req.url</strong></p> <p>是客户端浏览器发送GET请求的<strong>url地址</strong></p> <p>GET请求的参数可通过url内置模块辅助获取</p></li> <li><p><strong>req.method</strong></p> <p>客户端请求的方式</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'有客户端来访问服务器了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li><p>req.on</p> <p>监听POST请求的参数的传递</p> <p>当有数据传递时便会触发req.on事件</p> <p>当数据传递完成时便会触发req.end事件</p> <p>POST请求的参数会很大，放在了请求体中传输，不是一次性传递完成的，</p> <p>是分批次的，需要通过变量拼接获取完整POST请求参数</p> <p>最后可通过querystring内置模块将拼接的字符串转为对象形式获取POST参数</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> querystring <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'querystring'</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  
  <span class="token keyword">let</span> postParams <span class="token operator">=</span> <span class="token string">''</span>

	req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  	postParams <span class="token operator">+=</span> params
	<span class="token punctuation">}</span><span class="token punctuation">)</span>

	req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'传输完成'</span><span class="token punctuation">)</span>
  	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>querystring<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>postParams<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
  
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><hr> <h4 id="res响应对象"><a href="#res响应对象" class="header-anchor">#</a> res响应对象</h4> <p>包含服务端相关的数据和属性</p> <ul><li><p><strong>res.end</strong></p> <p>向客户端响应指定内容，并结束该次请求的处理</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'有客户端来访问服务器了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'&lt;h1&gt;Hello&lt;/h1&gt;'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li><p><strong>res.setHeader</strong></p> <p>设置响应头</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 可用于的设置编码格式来解决res.end() 乱码</span>
res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span><span class="token string">'text/html; charset=utf-8'</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'有客户端来访问服务器了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span><span class="token string">'text/html; charset=utf-8'</span><span class="token punctuation">)</span>
  
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'&lt;h1&gt;你好&lt;/h1&gt;'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li><p>res.writeHead</p> <p>设置响应状态、响应数据类型、编码类型</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token string">'Content-type'</span><span class="token operator">:</span><span class="token string">'text/plain;charset=utf8'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="简单路由"><a href="#简单路由" class="header-anchor">#</a> 简单路由</h3> <p>根据判断客户端请求URL地址路径的不同，响应不同的页面内容</p> <p>如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'有客户端来访问服务器了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token comment">// 获取 客户端发送的URL请求地址</span>
    <span class="token keyword">const</span> url <span class="token operator">=</span> req<span class="token punctuation">.</span>url
    <span class="token comment">// 设置默认响应内容 404</span>
    <span class="token keyword">let</span> responseContnet <span class="token operator">=</span> <span class="token string">'&lt;h1&gt;404 Not Found&lt;/h1&gt;'</span>

    <span class="token comment">// 判断 客户端发送的URL请求地址</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>url <span class="token operator">===</span> <span class="token string">'/'</span> <span class="token operator">||</span> url <span class="token operator">===</span> <span class="token string">'/index.html'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        responseContnet <span class="token operator">=</span> <span class="token string">'&lt;h1&gt;index 首页&lt;/h1&gt;'</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>url <span class="token operator">===</span> <span class="token string">'/about.html'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        responseContnet <span class="token operator">=</span> <span class="token string">'&lt;h1&gt;About 页面&lt;/h1&gt;'</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 设置 响应头的编码格式</span>
    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'text/html; charset=utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 响应页面内容</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>responseContnet<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'服务器运行在http://127.0.0.7:3000'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="静态资源访问"><a href="#静态资源访问" class="header-anchor">#</a> 静态资源访问</h3> <ul><li><p>静态资源</p> <p>服务器不需要处理，直接响应给客户端的资源就是静态资源</p> <p>比如 .html文件、.css文件、.js文件、images图片...</p></li> <li><p>动态资源</p> <p>相同的请求地址但是请求参数不同</p> <p>服务器响应给 这种请的资源就是动态资源</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>abc<span class="token punctuation">.</span>com<span class="token operator">/</span>list<span class="token operator">?</span>id<span class="token operator">=</span><span class="token number">001</span>

http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>abc<span class="token punctuation">.</span>com<span class="token operator">/</span>list<span class="token operator">?</span>id<span class="token operator">=</span><span class="token number">002</span>
</code></pre></div><hr> <p>如下：</p> <p>服务器静态资源存放于public目录</p> <div class="language-js extra-class"><pre class="language-js"><code>xxxx
<span class="token operator">|</span><span class="token operator">-</span> <span class="token keyword">public</span>
		<span class="token operator">|</span><span class="token operator">-</span> images
				<span class="token operator">|</span><span class="token operator">-</span> <span class="token number">01.</span>jpg
		<span class="token operator">|</span><span class="token operator">-</span> css
				<span class="token operator">|</span><span class="token operator">-</span> index<span class="token punctuation">.</span>css
		<span class="token operator">|</span><span class="token operator">-</span> js
				<span class="token operator">|</span><span class="token operator">-</span> index<span class="token punctuation">.</span>js
		<span class="token operator">|</span><span class="token operator">-</span> index<span class="token punctuation">.</span>html
<span class="token operator">|</span><span class="token operator">-</span> app<span class="token punctuation">.</span>js
</code></pre></div><ol><li><p>通过url内置模块，获取不带请求参数的请求url路径</p></li> <li><p>通过path内置模块，拼接文件所在目录的绝对路径 + 请求路径</p></li> <li><p>通过fs内置模块，读取的内容响应给客户端</p></li> <li><p>通过mime第三方模块，动态设定响应报文的数据类型</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> mime <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mime'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token comment">// 1. </span>
  <span class="token comment">// let pathname = url.parse(req.url).pathname</span>
  <span class="token keyword">let</span> pathname <span class="token operator">=</span> <span class="token string">'/'</span> <span class="token operator">?</span> <span class="token string">'/index.html'</span> <span class="token operator">:</span>  url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>pathname
  <span class="token comment">// 2. </span>
 	<span class="token keyword">let</span> realPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span> __dirname<span class="token punctuation">,</span> <span class="token string">'public'</span> <span class="token operator">+</span> pathname<span class="token punctuation">)</span>
  <span class="token comment">// 3.</span>
  fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>realPath<span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
      res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token string">'Content-type'</span><span class="token operator">:</span><span class="token string">'text/html;charset=utf8'</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'404 Not Found'</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span>  
    <span class="token punctuation">}</span>
    <span class="token comment">// 4. </span>
    <span class="token keyword">let</span> type <span class="token operator">=</span> <span class="token function">mime</span><span class="token punctuation">(</span>realPath<span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token string">'Content-type'</span><span class="token operator">:</span> type
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
   	res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server running at http://localhost:3000'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="url-内置模块"><a href="#url-内置模块" class="header-anchor">#</a> url 内置模块</h2> <p>处理请求URL地址</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span>
</code></pre></div><ul><li><p>url.parse</p> <p>将URL请求地址转为对象形式</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span>query
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> getParams <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span>query

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>getParams<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>getParams<span class="token punctuation">.</span>age<span class="token punctuation">)</span>
</code></pre></div><h2 id="querystring-内置模块"><a href="#querystring-内置模块" class="header-anchor">#</a> querystring 内置模块</h2> <p>Node.js的内置模块，</p> <p>专门用来处理查询字符串</p> <p>通过<strong>parse()</strong> 将字符串转为对象格式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 在Express.js中</span>
<span class="token keyword">const</span> qs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'querystring'</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>qs<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'name=andy&amp;age=100'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;andy&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;age&quot;</span><span class="token operator">:</span> <span class="token string">&quot;100&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> querystring <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'querystring'</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  
  <span class="token keyword">let</span> postParams <span class="token operator">=</span> <span class="token string">''</span>

	req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  	postParams <span class="token operator">+=</span> params
	<span class="token punctuation">}</span><span class="token punctuation">)</span>

	req<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'传输完成'</span><span class="token punctuation">)</span>
  	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>querystring<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>postParams<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
  
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="模块化"><a href="#模块化" class="header-anchor">#</a> 模块化</h2> <h3 id="模块化概念"><a href="#模块化概念" class="header-anchor">#</a> 模块化概念</h3> <p>将一个大文件拆分为多个独立且相互有依赖的小文件（模块）</p> <p>每一个JavaScript就是一个模块</p> <ul><li>提高了代码的维护性、复用性</li> <li>可实现模块的按需加载</li></ul> <h3 id="node-js中模块的分类"><a href="#node-js中模块的分类" class="header-anchor">#</a> Node.js中模块的分类</h3> <ul><li><p>内置模块（内置的fs、path、http等）</p></li> <li><p>自定义模块（用户自己写的每个JS文件）</p></li> <li><p>第三方模块（也叫<strong>包</strong>，需要下载引入）</p></li></ul> <h3 id="模块的加载机制"><a href="#模块的加载机制" class="header-anchor">#</a> 模块的加载机制</h3> <h4 id="_1-完整路径-文件后缀"><a href="#_1-完整路径-文件后缀" class="header-anchor">#</a> 1. 完整路径 + 文件后缀</h4> <p>直接引入模块</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./targetModule.js'</span><span class="token punctuation">)</span>
</code></pre></div><hr> <h4 id="_2-有路径-但无后缀"><a href="#_2-有路径-但无后缀" class="header-anchor">#</a> 2. 有路径，但无后缀</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./targetModule'</span><span class="token punctuation">)</span>
</code></pre></div><ol><li><p>先指定的目录下查找，是否有同名文件的JS文件</p> <p>若找到了，则执行导入模块</p></li> <li><p>若找不到，则找到并打开同名文件夹，</p> <p>从中查找index.js文件</p> <p>若找到了，则执行</p></li> <li><p>若没有index.js，</p> <p>则在同名文件夹下package.json中mian指定的主入口文件</p> <p>若找到，则执行</p></li> <li><p>若package.json中mian没指定主入口文件，或没找到，</p> <p>则报错</p></li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>Cannot <span class="token function">find</span> module <span class="token string">'xxxxx'</span>
</code></pre></div><hr> <h4 id="_3-无路径-无后缀"><a href="#_3-无路径-无后缀" class="header-anchor">#</a> 3. 无路径，无后缀</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'targetModule'</span><span class="token punctuation">)</span>
</code></pre></div><ol><li><p>Node.js会假设是系统内置模块</p></li> <li><p>若不存在该内置模块，</p> <p>则去 node_modules目录中查找同名文件</p> <p>若找到了同名文件，则执行</p></li> <li><p>若没找到同名文件，</p> <p>会在node_modules目录中查找同名文件</p> <p>若找了同名文件夹，则查找其中的index.js</p> <p>若有index.js，则执行</p></li> <li><p>若无index.js，</p> <p>则查找该同名文件夹的package.json的main的入口文件</p> <p>若找到则执行</p></li> <li><p>若package.json中mian没指定主入口文件，或没找到，</p> <p>则报错</p></li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>Cannot <span class="token function">find</span> module <span class="token string">'xxxxx'</span>
</code></pre></div><hr> <h4 id="优先内置模块"><a href="#优先内置模块" class="header-anchor">#</a> 优先内置模块</h4> <p>Node.js的<strong>内置模块的加载优先级最高</strong></p> <p>假若同时加载重名的模块，最终导入的是内置模块</p> <hr> <h4 id="优先缓存加载"><a href="#优先缓存加载" class="header-anchor">#</a> 优先缓存加载</h4> <p>模块都是优先缓存中加载</p> <p>模块在第一次被 require()加载后会被缓存，</p> <p>即使多次调用require() 导入相同模块也不会导致模块内代码重复被多次执行，</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> xxx <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'xxx'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> xxx <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'xxx'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> xxx <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'xxx'</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="commonjs规范"><a href="#commonjs规范" class="header-anchor">#</a> CommonJS规范</h2> <p>Node.js 遵循CommonJS的模块化规范解决模块与模块之间的依赖关系：</p> <ul><li><p>每个模块内部的module变量代表当前模块</p></li> <li><p>module变量是个对象，</p> <p>其<strong>exports属性（module.exports）是对导出模块内容</strong></p></li> <li><p><strong>require() 用于加载模块</strong>，</p> <p>加载的是该模块的导出的module.exports属性的内容</p></li></ul> <h3 id="commonjs-加载模块"><a href="#commonjs-加载模块" class="header-anchor">#</a> CommonJS - 加载模块</h3> <p>通过 **require() **加载执行其他模块</p> <p>内置模块和第三方模块直接写名字，</p> <p>自定义模块要写文件路径</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 内置模块</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span> 

<span class="token comment">// 自定义模块</span>
<span class="token keyword">const</span> calculate <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./calcaulat.js'</span><span class="token punctuation">)</span>

<span class="token comment">// 第三方模块</span>
<span class="token keyword">const</span> xxx <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'xxx'</span><span class="token punctuation">)</span>
</code></pre></div><hr> <p><strong>require() ** 是被导入模块的</strong>module对象中的exports属性**的内容，</p> <p>因为module.exports默认是个空对象 <strong>{ }</strong> ，</p> <p>所以require()默认导入一个空对象 <strong>{ }</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 导出成员的模块</span>
<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">20</span>

<span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token number">0</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    b <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">10</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> <span class="token function-variable function">c</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>a <span class="token operator">=</span> a
module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>b <span class="token operator">=</span> b
module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>c <span class="token operator">=</span> c
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 导入自定义模块的JS文件</span>
<span class="token keyword">const</span> m1 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./01'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>m1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// { a: 30, b: 0, c: [Function: c] }</span>
m1<span class="token punctuation">.</span><span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// Hello</span>
</code></pre></div><h3 id="模块作用域"><a href="#模块作用域" class="header-anchor">#</a> 模块作用域</h3> <p>在自定义模块中定义的变量、方法</p> <p>只能在当前模块内被访问、使用</p> <p>即使模块被导入也无法直接访问使用其中的变量方法</p> <p>模块作用域的限制有利于防止全局变量污染</p> <h3 id="commonjs-暴露模块成员"><a href="#commonjs-暴露模块成员" class="header-anchor">#</a> CommonJS - 暴露模块成员</h3> <p>因为有模块作用域的限制，</p> <p>模块只被导入使用其中的变量、方法无法被访问使用，还需要在模块中将其对外暴露（共享）</p> <hr> <h4 id="module对象"><a href="#module对象" class="header-anchor">#</a> module对象</h4> <p>每个 JS文件中都有一个<strong>module对象</strong>，存储了和当前模块相关的信息</p> <p>其中的 <strong>exports 属性</strong> 可以向外暴露共享模块内成员，默认是个空对象 <strong>{ }</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span><span class="token punctuation">;</span>


Module <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token string">'.'</span><span class="token punctuation">,</span>
  path<span class="token operator">:</span> <span class="token string">'/Users/chen/StudyPractice/JS/req'</span><span class="token punctuation">,</span>
  exports<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  parent<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  filename<span class="token operator">:</span> <span class="token string">'/Users/chen/StudyPractice/JS/req/02.js'</span><span class="token punctuation">,</span>
  loaded<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  children<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  paths<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">'/Users/chen/StudyPractice/JS/req/node_modules'</span><span class="token punctuation">,</span>
    <span class="token string">'/Users/chen/StudyPractice/JS/node_modules'</span><span class="token punctuation">,</span>
    <span class="token string">'/Users/chen/StudyPractice/node_modules'</span><span class="token punctuation">,</span>
    <span class="token string">'/Users/chen/node_modules'</span><span class="token punctuation">,</span>
    <span class="token string">'/Users/node_modules'</span><span class="token punctuation">,</span>
    <span class="token string">'/node_modules'</span>
  <span class="token punctuation">]</span>
</code></pre></div><hr> <h4 id="module-exports对象"><a href="#module-exports对象" class="header-anchor">#</a> module.exports对象</h4> <p>在自定义模块中，</p> <p>可以将模块内的变量、方法挂载到<strong>module.exports对象</strong> ，</p> <p>将模块内部的私有成员向外暴露分享出去供其他模块使用</p> <p>module.exports默认是个空对象 <strong>{ }</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>exports<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// {}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">20</span>

<span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token number">0</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    b <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">10</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> <span class="token function-variable function">c</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>a <span class="token operator">=</span> a
module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>b <span class="token operator">=</span> b
module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>c <span class="token operator">=</span> c
</code></pre></div><hr> <h4 id="exports对象"><a href="#exports对象" class="header-anchor">#</a> exports对象</h4> <p>但因为module.exports写起了麻烦，Node提供了exports对象</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">20</span>

<span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token number">0</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    b <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token number">10</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> <span class="token function-variable function">c</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


exports<span class="token punctuation">.</span>a <span class="token operator">=</span> a
exports<span class="token punctuation">.</span>b <span class="token operator">=</span> b
exports<span class="token punctuation">.</span>c <span class="token operator">=</span> c
</code></pre></div><p>exports对象和module.exports对象指向的内容相同（地址引用）</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>exports <span class="token operator">===</span> exports<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// true</span>
</code></pre></div><p>若exports对象和module.exports对象指向的对象不同时，</p> <p>最终模块对外暴露的内容永远以 module.exports对象指向的为准</p> <hr> <h4 id="区别module-exports-exports"><a href="#区别module-exports-exports" class="header-anchor">#</a> 区别module.exports, exports</h4> <p><img src="https://pbs.twimg.com/media/E3V1z7gVoBYDogY?format=jpg&amp;name=medium" alt=""></p> <ul><li><p>module.exports默认是个空对象</p></li> <li><p>exports默认也是个空对象</p></li> <li><p><strong>二者指向同一个引用地址</strong></p></li> <li><p>若二者指向的是不同对象时，</p> <p>以module.exports为准，exports指向失效</p></li> <li><p>通过exprots.属性的方式挂在模块成员，</p> <p>可以反映到module.exports指向的对象的内容</p></li> <li><p>直接让 exports等于一个新对象，</p> <p>并不会修改module.exports指向的对象的内容</p> <p>最终模块对外暴露的内容永远以 module.exports对象指向的为准</p> <p><strong>ES6对象的健值同名时的简写</strong>只能用于module.exports</p></li></ul> <p>所以，上4图</p> <ol><li><p>exprots指向对象 { username='zs'} 后，</p> <p>又使module.exports指向一个新对象</p> <p>最终以module.exports对象指向为准</p></li> <li><p>module.exports指向一个对象 { username='zs'} 后，</p> <p>又使exports指向一个新对象</p> <p>最终以module.exports对象指向为准</p></li> <li><p>exprots指向对象 { username='zs'} 后，</p> <p>在此基础上，又追加module.exports的一个属性gender='男'</p> <p>最终以追加了属性module.exports对象指向为准</p></li> <li><p>exprots指向对象后，</p> <p>又使module.exports指向exprots</p> <p>在此基础上，又追加module.exports的一个属性age='22'</p> <p>最终以追加了属性module.exports对象指向为准</p></li></ol> <hr> <p>为了防止混乱，导出模块是不要混用</p> <h2 id="第三方模块"><a href="#第三方模块" class="header-anchor">#</a> 第三方模块</h2> <p>也叫做包（package）</p> <p>是基于内置模块封装出的，效率更高</p> <p>一般由多个文件构成，放到了一个文件夹中</p> <p>有两种形式：</p> <ul><li><p>JS文件的形式（body-parser）</p> <p>提供具体功能的API方法函数接口</p></li> <li><p>命令行工具的形式（nodemon）</p> <p>负责项目开发</p></li></ul> <p>通过第三方模块的存储和分发仓库npm获取</p> <p>详见npm笔记</p> <h2 id="node-js的异步"><a href="#node-js的异步" class="header-anchor">#</a> Node.js的异步</h2> <p>Node.js中的API有两种，一种是同步API，一种是异步API</p> <p>异步API的返回值需要通过回调函数来获取，</p> <p>若多个异步调用的结果存在依赖关系，就需要嵌套，</p> <p>会导致嵌套层数过多，就是<strong>回调地狱</strong></p> <h3 id="异步嵌套-回调地狱"><a href="#异步嵌套-回调地狱" class="header-anchor">#</a> 异步嵌套（回调地狱）</h3> <p>比如，fs模块依次读取A文件、B文件、C文件、D文件</p> <p>多个异步调用嵌套层数过多，会导致维护困难</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./A.html'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
    
	fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./B.html'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
    
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./C.html'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
      
      fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./D.html'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="promise解决回调地狱"><a href="#promise解决回调地狱" class="header-anchor">#</a> Promise解决回调地狱</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">第一个</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span>rej</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// 成功时</span>
    <span class="token function">res</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 失败时</span>
    <span class="token function">rej</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">第二个</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span>rej</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// 成功时</span>
    <span class="token function">res</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 失败时</span>
    <span class="token function">rej</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">第一个</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  		<span class="token comment">// console.log(res)</span>
  		retuen <span class="token function">第二个</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  		<span class="token comment">// console.log(res)</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ol><li><p>原本是需要嵌套调用三次 fs.readFile()</p> <p>因为是异步API，嵌套会有回调地狱，</p> <p>可使用promise</p></li> <li><p>将异步函数外包裹一个promise实例对象，</p> <p>并将promise实例对象放入一个函数</p> <p>每个函数return 返回的是创建的promise实例对象</p></li> <li><p>异步执行成功时，通过promise实例对象的resolve参数传出结果</p> <p>异步执行失败时，通过promise实例对象的reject参数传出结果</p></li> <li><p>调用函数（第一个Promise实例对象）</p> <p>通过then()方法获取异步执行的结果，</p> <p>并return返回下一个函数的调用（Promise实例对象）</p> <p>链式编程依次调用函数</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">p1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">reslove<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./A.js'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token function">reslove</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">p2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">reslove<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

        fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./B.js'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token function">reslove</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">p3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">reslove<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

        fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./C.js'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token function">reslove</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>


<span class="token function">p1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res1</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">p2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res2</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">p3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res3</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="async异步函数解决回调地狱"><a href="#async异步函数解决回调地狱" class="header-anchor">#</a> async异步函数解决回调地狱</h3> <blockquote><p>Promise还是比较繁琐</p> <ul><li><p>需要手动给每个异步API包裹上Promise对象</p></li> <li><p>还要手动调用resolve和reject传递出异步执行结果</p></li> <li><p>外部的链式比较臃肿</p></li></ul></blockquote> <p>将异步嵌套写成了同步的形式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">p1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">'p1'</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">p1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">'p2'</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">p1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">'p2'</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">let</span> res1 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">p1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> res2 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">p2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> res3 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">p3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res1<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res2<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res3<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="util内置模块"><a href="#util内置模块" class="header-anchor">#</a> util内置模块</h4> <p>包装Node.js的API，使返回值为Promise对象</p> <p>然后才能支持异步函数的语法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> promisify <span class="token operator">=</span>  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'util'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>promisify
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> promisify <span class="token operator">=</span>  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'util'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>promisify
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> readFile <span class="token operator">=</span> <span class="token function">promisify</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span>readFile<span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">run</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">let</span> res1 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./A.html'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> res1 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./B.html'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> res1 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./C.html'</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res1<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res2<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res3<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/vuepress-studynotes/assets/js/app.0e9e348b.js" defer></script><script src="/vuepress-studynotes/assets/js/2.5f9531f9.js" defer></script><script src="/vuepress-studynotes/assets/js/22.e2575d2d.js" defer></script>
  </body>
</html>
